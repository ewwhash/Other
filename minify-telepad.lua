whiteList={}symbol="?"side=3;bufferSide=3;ejectSide=1;version="selector"local function a(b)return component.proxy(component.list(b)())end;local c,d,e,f,g=a("inventory_controller"),a("robot"),a("redstone"),a("chat"),a("tractor_beam")local h=d.inventorySize()local i,j,k,l={},1,0;local function m(n,o)return unicode.lower(unicode.sub(n.label,1,1))<unicode.lower(unicode.sub(o.label,1,1))end;local function p()table.sort(i,m)local j,k=1,0;for q=1,#i do i[q].page=j;k=k+1;if k==8 then j,k=j+1,0 end end end;local function r(s)local t=computer.uptime()+s;repeat computer.pullSignal(t-computer.uptime())until computer.uptime()>=t end;local function u(v,w)d.select(w)f.say("§7Выкидываю мусор: '§a"..v.."§7'...")d.drop(0)d.select(1)end;local function x(w,y)local z=c.getStackInInternalSlot(w)if z then if z.name=="EnderIO:itemCoordSelector"or z.name=="enderio:item_location_printout"then if k==8 then j,k=j+1,0 end;local q=#i+1;i[q]={label=z.label,slot=w}i[q].title="§f'§a"..z.label.."§f'"i[q].page=j;k=k+1;table.sort(i,m)if y then f.say("§7Обнаружена новая точка '§a"..z.label.."§7'!")end else u(z.label,w)end end end;local function A()i={}local B,counter=1,0;for w=1,h do x(w)end;f.say("Сканирование завершено. Точек найдено: "..#i)end;local function C()f.say("§7Телепорт на точку: §c?tp §bточка§7.")f.say("§7Список точек: §c?list §bстраница§7.")f.say("§7Извлечь точку: §c?eject §bточка§7.")f.say("§7Добавление точки: §c?addpoint§7.")f.say("§7Обновление точек: §c?update§7.")end;local function D()e.setOutput(side,15)r(.1)e.setOutput(side,0)end;local function E(q)f.say("§7Подготовка к телепортации на '§a"..i[q].label.."§7'...")d.select(i[q].slot)if version=="selector"then c.equip()d.use(side,true)D()c.equip()elseif version=="paper"then d.drop(side)D()counter=0;while true do local z=c.getStackInSlot(bufferSide,1)counter=counter+1;if z and z.name=="enderio:item_location_printout"then d.suck(bufferSide)break end;if counter==500 then f.say("§cНе могу достать распечатку!")counter=0 end;r(0)end end;d.select(1)end;local function F(v)local G=false;local H=unicode.len(v)for q=1,#i do if unicode.sub(unicode.lower(i[q].label),1,H)==v then G=q;break end end;if G then return G else f.say("§cТочки "..v.." не существует!")end end;local function I(v)if v then v=unicode.lower(v)local q=F(v)if q then l=q;E(q)else C()end elseif l then E(l)else C()end end;local function J()if g.suck()then local K,w=computer.pullSignal(.3)if K=="inventory_changed"then x(w,true)end end end;local function L(v)if v then local q=F(unicode.lower(v))if q then f.say("§7Извлечение точки '§a"..i[q].label.."§7'...")d.select(i[q].slot)d.drop(ejectSide)d.select(1)k=k-1;if k==0 and j>=2 then j=j-1;k=8 end;table.remove(i,q)p()end else C()end end;local function M(B)if B then B=tonumber(B)if not B then C()else B=math.floor(B)end else B=1 end;if B then if B>j then f.say("§cВсего "..j.." страниц.")else f.say("§6§lТочки - Страница "..B.."/"..j)for q=1,#i do if i[q].page==B then f.say(i[q].title)end end end end end;local N={help=C,tp=I,list=M,update=A,addpoint=J,eject=L}for O=1,#whiteList do whiteList[whiteList[O]],whiteList[O]=true,nil end;d.select(1)f.setName("§eTelepad§7§o")A()while true do local P={computer.pullSignal()}if P[1]=="chat_message"and whiteList[P[3]]then f.setName("§eTelepad§7§o")if P[4]:sub(1,1)==symbol then local Q=P[4]:sub(2,#P[4])local R={}for S in Q:gsub("^(.-)%s*$","%1"):gmatch("%s*([^%s]+)")do R[#R+1]=("%q"):format(S):gsub('"','')end;if N[R[1]]then N[R[1]](table.unpack(R,2,#R))else C()end end end end
